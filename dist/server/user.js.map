{"version":3,"sources":["../../server/user.js"],"names":["express","require","mysql","config","router","Router","connection","createConnection","mysqlConfig","connect","post","req","res","next","email","body","psw","findUser","query","err","result","console","log","json","length","sqlPsw","password","nickname","createdAT","updatedAT","createUser","errno","sendData","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["\r\nvar express = require('express');\r\nvar mysql = require('mysql');\r\nvar config = require(\"./app-config.js\");\r\n\r\nvar router = express.Router();\r\n\r\nvar connection = mysql.createConnection(config.mysqlConfig);\r\nconnection.connect();\r\nrouter.post(\"/login\",function (req,res,next){\r\n    var email = req.body.email;\r\n    var psw = req.body.psw;\r\n    var findUser = 'select * from user where email = \"'+email+'\"';\r\n    connection.query(findUser,function (err,result) {\r\n        if(err){\r\n            console.log(err);\r\n            res.json({\r\n                'code':'sqlerror'\r\n            });\r\n        }else {\r\n            console.log(result[0]);\r\n            if(result.length>0){\r\n                var sqlPsw = result[0].password;\r\n                if (sqlPsw == psw){\r\n                    res.json({\r\n                        'code':'success',\r\n                        'email':result[0].email,\r\n                        'nickname':result[0].nickname,\r\n                        'createdAT':result[0].createdAT,\r\n                        'updatedAT':result[0].updatedAT\r\n                    });\r\n                }else {\r\n                    res.json({\r\n                        'code':'pswError'\r\n                    });\r\n                }\r\n            }else {\r\n                res.json({\r\n                    'code':'error',\r\n                    'email':'this email is not existed'\r\n                });\r\n            }\r\n        }\r\n    })\r\n    // console.log(req.body);\r\n    // res.send(req.body);\r\n});\r\n\r\nrouter.post('/register' , function (req,res,next) {\r\n    var email = req.body.email;\r\n    var psw = req.body.psw;\r\n    var nickname = req.body.nickname;\r\n    if(email&&psw&&nickname){\r\n\r\n        var createUser = 'insert into user (email , password ,nickname) values(' +\r\n                '\\''+email+'\\',' +\r\n            '\\''+psw +'\\''+ ','+\r\n            '\\''+nickname +'\\'' +\r\n            ')';\r\n        console.log(createUser);\r\n        connection.query(createUser ,function (err,result) {\r\n            if(err){\r\n                console.log(err);\r\n                if(err.errno == 1062){\r\n                    res.json({\r\n                        'code':'existed',\r\n                        'email':email\r\n                    });\r\n                }else {\r\n                    res.json({\r\n                        'code':'sqlerror',\r\n                        'email':email,\r\n                        'psw':psw,\r\n                        'nickname':nickname\r\n                    });\r\n                }\r\n\r\n            }else {\r\n                console.log(result);\r\n                res.json({\r\n                    'code':'success'\r\n                });\r\n            }\r\n        });\r\n\r\n\r\n    }else {\r\n        var sendData = {\r\n            'code':'error',\r\n            'email':email,\r\n            'psw':psw,\r\n            'nickname':nickname\r\n        }\r\n        res.json(sendData);\r\n    }\r\n});\r\n\r\n\r\n\r\nmodule.exports = router;\r\n"]}